<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>File Upload</title>
    </head>
    <script src="https://cdn.tailwindcss.com"></script>

    <body class="bg-zinc-800">
        <img id="uploaded-img" src="" class="max-w-md mx-auto mt-8 rounded-md shadow-xl" />

        <video
            id="uploaded-video"
            class="max-w-md mx-auto mt-8 rounded-md shadow-xl hidden max-h-[480px]"
        >
            <source src="" type="video/mp4" />
        </video>

        <form
            class="max-w-xl mx-auto"
            id="uploadForm"
            action="/upload"
            method="post"
            enctype="multipart/form-data"
        >
            <div class="space-y-12">
                <div class="pb-12">
                    <div class="mt-10 grid grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-6">
                        <div class="col-span-full">
                            <h2 class="text-white text-2xl">Add a File</h2>
                            <div
                                class="mt-2 flex justify-center rounded-lg border border-dashed border-white/25 px-6 py-10"
                            >
                                <div class="text-center">
                                    <div class="my-4 flex text-sm leading-6 text-gray-400">
                                        <label
                                            for="file-upload"
                                            class="relative cursor-pointer rounded-md bg-green-900 font-semibold text-white px-3 py-1"
                                        >
                                            <span>Add a file</span>
                                            <input
                                                id="file-upload"
                                                name="prop-media"
                                                type="file"
                                                class="sr-only my-4"
                                            />
                                        </label>
                                    </div>
                                    <p class="text-xs leading-5 text-gray-400">
                                        PNG, JPG, GIF, MP4 up to 5MB
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="mt-6 flex items-center justify-end gap-x-6">
                <button
                    type="submit"
                    class="rounded-md bg-emerald-700 px-3 py-2 text-sm font-semibold text-white shadow-sm"
                >
                    Upload
                </button>
            </div>
        </form>
    </body>
    <script type="text/javascript">
        const img = document.getElementById("uploaded-img");
        const form = document.getElementById("uploadForm");
        const videoElement = document.getElementById("uploaded-video");

        form.addEventListener("change", function (e) {
            const file = e.target.files[0];
            videoElement.classList.add("hidden");
            videoElement.src = "";
            img.src = "";
            if (file) {
                const objectURL = URL.createObjectURL(file);
                if (file.type.startsWith("image")) {
                    document.getElementById("uploaded-img").src = objectURL;
                } else if (file.type.startsWith("video")) {
                    videoElement.src = objectURL;
                    videoElement.controls = false;
                    videoElement.classList.remove("hidden");
                }
            }
        });

        form.addEventListener("submit", function (e) {
            e.preventDefault();
            var formData = new FormData(this);
            fetch("/upload", {
                method: "POST",
                body: formData,
            })
                .then((response) => response.json())
                .then((data) => {
                    console.log(data);
                    if (data.fileURI) {
                        img.setAttribute("src", data.fileURI);
                    }
                })
                .catch((error) => {
                    console.error("Error:", error);
                });
        });
    </script>
</html>
